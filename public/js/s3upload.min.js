!function(){window.S3Upload=function(){function a(a){null==a&&(a={});for(option in a)this[option]=a[option];this.handleFileSelect(document.getElementById(this.file_dom_selector))}return a.prototype.s3_object_name="default_name",a.prototype.s3_sign_put_url="/signS3put",a.prototype.file_dom_selector="file_upload",a.prototype.onFinishS3Put=function(a){return console.log("base.onFinishS3Put()",a)},a.prototype.onProgress=function(a,b){return console.log("base.onProgress()",a,b)},a.prototype.onError=function(a){return console.log("base.onError()",a)},a.prototype.handleFileSelect=function(a){var b,c,d,e,f,g;for(this.onProgress(0,"Upload started."),c=a.files,d=[],g=[],e=0,f=c.length;f>e;e++)b=c[e],g.push(this.uploadFile(b));return g},a.prototype.createCORSRequest=function(a,b){var c;return c=new XMLHttpRequest,null!=c.withCredentials?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},a.prototype.executeOnSignedUrl=function(a,b){var c,d;return c=this,d=new XMLHttpRequest,d.open("GET",this.s3_sign_put_url+"?s3_object_type="+a.type+"&s3_object_name="+this.s3_object_name,!0),d.overrideMimeType("text/plain; charset=x-user-defined"),d.onreadystatechange=function(){var d;if(4===this.readyState&&200===this.status){try{d=JSON.parse(this.responseText)}catch(e){return c.onError('Signing server returned some ugly/empty JSON: "'+this.responseText+'"'),!1}return b(decodeURIComponent(d.signed_request),d.url)}return 4===this.readyState&&200!==this.status?c.onError("Could not contact request signing server. Status = "+this.status):void 0},d.send()},a.prototype.uploadToS3=function(a,b,c){var d,e;return d=this,e=this.createCORSRequest("PUT",b),e?(e.onload=function(){return 200===e.status?(d.onProgress(100,"Upload completed."),d.onFinishS3Put(c)):d.onError("Upload error: "+e.status)},e.onerror=function(){return d.onError("XHR error.")},e.upload.onprogress=function(a){var b;return a.lengthComputable?(b=Math.round(100*(a.loaded/a.total)),d.onProgress(b,100===b?"Finalizing.":"Uploading.")):void 0}):this.onError("CORS not supported"),e.setRequestHeader("Content-Type",a.type),e.setRequestHeader("x-amz-acl","public-read"),e.send(a)},a.prototype.uploadFile=function(a){var b;return b=this,this.executeOnSignedUrl(a,function(c,d){return b.uploadToS3(a,c,d)})},a}()}.call(this);